"0","# pcp = function(data, transect,"
"0","#                                surveyyear = levels(as.factor(data$YEAR)),"
"0","#                                background = TRUE,"
"0","#                                legendnames = c(paste(transect, collapse = "" ""), ""Others""),"
"0","#                                legendtitle = ""Ranch"","
"0","#                                legend = TRUE,"
"0","#                                boxcolors = c(""black"", ""gray""),"
"0","#                                xlabels = c(""Carbon 0-10 cm"", ""Carbon 10-40 cm"", ""Bulk Density""),"
"0","#                                ylab = ""% Change"","
"0","#                                choosevariables = c(""Carbon010change"", ""Carbon1040change"",""Bulk.density.change""))"
"0","# {"
"0","# "
"0","#   library(reshape2)"
"0","#   library(dplyr)"
"0","#   library(ggplot2)"
"0","#   library(ggrepel)"
"0","#   pc = function(x){(diff(x)/x[1]) * 100}"
"0","# "
"0","# "
"0","# "
"0","# "
"0","#   data$YEAR = as.factor(data$YEAR)"
"0","#   data = subset(data, YEAR %in% surveyyear)"
"0","#   if(!background){data = subset(data, subset = Transect %in% transect)}"
"0","#   duped = data$Point[duplicated(data$Point)]"
"0","#   data = data[data$Point %in% duped,]"
"0","#   if(!(transect %in% data$Transect)){stop(""Transect does not contain multiple surveys"")}"
"0","#   data$YEAR = as.factor(data$YEAR)"
"0","# "
"0","# "
"0","#   data2 = subset(data,select=c(""Point"", ""Transect"", ""YEAR"", ""Carbon.0.10.cm"", ""Carbon.10.40.cm"","
"0","#                                ""Bulk.Density""))"
"0","# "
"0","# "
"0","#   aggs = aggregate(data2[4:6], by = list(data2$Point), pc)"
"0","#   colnames(aggs) = c(""Point"", ""Change.Carbon0-10"", ""Change.Carbon10-40"", ""BD"")"
"0","#   data2 = subset(data2, data2$YEAR == max(levels(droplevels(data2$YEAR))))"
"0","#   data2 = merge(data2, aggs, by= ""Point"", all.x = T)"
"0","# "
"0","# "
"0","# "
"0","# "
"0","# "
"0","#   masked = data2"
"0","#   masked$Transect = as.character(replace(as.character(masked$Transect),"
"0","#                                          masked$Transect != transect, values = ""zzzz""))"
"0","#   masked$Transect = as.character(replace(as.character(masked$Transect),"
"0","#                                          masked$Transect == transect, values = ""aaaa""))"
"0","# "
"0","#   masked = masked %>% arrange(desc(Transect))"
"0","# "
"0","#   colnames(masked)[7:9] = c(""Carbon010change"", ""Carbon1040change"",""Bulk.density.change"")"
"0","# "
"0","#   masked = subset(masked, select = c(""Point"", ""Transect"" , choosevariables))"
"0","# "
"0","#   masked = melt(masked, id.vars = c(""Point"", ""Transect""))"
"0","# masked = masked[!is.na(masked$variable),]"
"0","# masked = masked[!is.nan(masked$variable),]"
"0","# "
"0","# "
"0","#   p = ggplot(masked, aes(x = variable, y = value, color = Transect)) +"
"0","#     geom_boxplot() +"
"0","#     scale_color_manual(values = boxcolors, labels = legendnames) +"
"0","#     guides(color = ifelse(legend, guide_legend(title = legendtitle), FALSE), label = FALSE) +"
"0","#     theme_bw() +"
"0","#     scale_x_discrete(labels = xlabels) +"
"0","#     geom_hline(yintercept = 0, linetype = 'dotted') +"
"0","#     ylab(ylab) +"
"0","#     xlab(NULL)"
"0","# "
"0","#   return(p)"
"0","# "
"0","# "
"0","# }"
"0","# "
"0","# pcp(soil, ""ABER"", surveyyear = as.character(2015:2018))"
