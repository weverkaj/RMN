---
title: "RMN Plant Monitoring Summary"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
```
Grazing can change plant community structure and composition by removing and trampling aboveground biomass and changing photosynthetic capacity, growth rates, and competitive dynamics of plants. Grazing that is meant to benefit vegetation communities in California is often focused on reducing thatch, slowing or reversing successional trajectories, and increasing species and functional diversity, such as perennial grasses. Managers typically control the timing and intensity of grazing to achieve these goals. 


```{r echo = FALSE, message = FALSE, warning = FALSE}

library(reshape2)
library(ggplot2)
library(knitr)
library(plyr)
library(RMN)
library(lubridate)
library(dplyr)
```

```{r}

# Set your working directory. This is the pathway to the file where you keep your downloaded data. 
# All products get written to this as well.
# I recommend 1 folder per ranch
# Replace the filepath in quotes with your filepath
# Remember to change the backslashes ("\") to forward slashes ("/")


# Read in Veg data
# Replace the filename in quotes with whatever you named the file 

name = "TOKA"

main<-read.csv("smc_main.csv") %>% add.pointyear() %>% subset(Transect.Name == name)
lpi<-read.csv("smc_lpi.csv") %>% add.pointyear() %>% subset(subset = (Soil.Surface != "" & Top.Layer != "")) %>% subset(Transect.Name == name)
checklist<-read.csv("smc_check.csv") %>% add.pointyear() %>% subset(Transect.Name == name)
# Read in the California Plants list and Invasivs.  
##These are files you should have gotten from Libby. 
##Bug her if you didn't




```

```{r}
cover.sum.plot(lpi, checklist)

```


```{r}

SppList = species.list(lpi, checklist)

kable(SppList)

```

```{r}

e = species.cover.table(lpi)
g = species.cover.table(lpi, type = "relative")
h = functional.cover.table(lpi)
j = functional.cover.table(lpi, type = "relative")
k = functional.cover.table(lpi, invasives = TRUE)
l = functional.cover.table(lpi, type = "relative", invasives = TRUE)

```







This is a absolute cover summary figure without invasives as a functional group

```{r echo = FALSE, message = FALSE, warning = FALSE}


points.cover.plot(lpi, type = "absolute")
#dev.print(pdf,"CommunityNoInvasive.pdf")  
```
Absolute cover with invasives as a functional group
```{r echo = FALSE, message = FALSE, warning = FALSE}

points.cover.plot(lpi, invasives = TRUE)
#dev.print(pdf,"CommunityNoInvasive.pdf")  
```





```{r echo = FALSE, message = FALSE, warning = FALSE}

se <- function(x) sqrt(var(x, na.rm = TRUE)/length(na.omit(x)))

d = abs
d$year = as.factor(d$year)
d$Type = as.factor(d$Type)

d2 = subset(d, subset = year == max(levels(year)))
d1 = subset(d, subset = year == min(levels(year)))

coveryear = merge(d1, d2, by = c("Point.Id", "Type"))
coveryear$change = coveryear$Cover.y - coveryear$Cover.x


x = aggregate(coveryear, by = list(coveryear$Type), FUN = "mean")
x = subset(x, select = c(Group.1, change))
y = aggregate(coveryear, by = list(coveryear$Type), FUN = "se")
y = subset(y, select = c(Group.1, change))
colnames(x) = c("Functional_Group", "Percent_Change")
colnames(y) = c("Functional_Group", "Standard_error")

x$Percent_Change = x$Percent_Change * 100
y$Standard_error = y$Standard_error * 100

coverchange = merge(x, y, by = "Functional_Group")

a = aggregate(coveryear, by = list(coveryear$Type), FUN = "mean")
a = subset(a, select = c("Group.1", "Cover.y"))
colnames(a) = c("Functional_Group", "Percent_Cover")
b = aggregate(coveryear, by = list(coveryear$Type), FUN = "se")
b = subset(b, select = c("Group.1", "Cover.y"))
colnames(b) = c("Functional_Group", "Standard_error")

current_cover = merge(a, b, by = "Functional_Group")

```
Here is a graph of absolute cover of functional groups

```{r, echo = FALSE}

cover_plot = ggplot(current_cover, aes(x = Functional_Group, y = Percent_Cover)) + 
  geom_col() + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + geom_errorbar(ymin = (current_cover$Percent_Cover - current_cover$Standard_error), ymax = (current_cover$Percent_Cover + current_cover$Standard_error), width = 0.5) + ylim(0, (max(current_cover$Percent_Cover) + max(current_cover$Standard_error)))

cover_plot

```


Here is a graph of change in functional groups

```{r echo = FALSE, message = FALSE, warning = FALSE}

c = ggplot(coverchange, aes(x = Functional_Group, y = Percent_Change)) + geom_col() + theme_bw() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + geom_errorbar(ymin = coverchange$Percent_Change - coverchange$Standard_error, ymax = coverchange$Percent_Change + coverchange$Standard_error, width = 0.5) + ylim((min(coverchange$Percent_Change) - max(coverchange$Standard_error)), (max(coverchange$Percent_Change) + max(coverchange$Standard_error)))
c


```





```{r echo = FALSE, message = FALSE, warning = FALSE}

ds = data.summary

ds$year = as.factor(ds$year)
ds$tree_cover = ds$Percent.Cover.x
ds$shrub_cover = ds$Percent.Cover.y


ds$Percent.Cover.x = NULL
ds$Percent.Cover.y = NULL
ds$NumIndices = NULL
ds$Vegetation.Type.x = NULL
ds$Vegetation.Type.y = NULL

ds<-melt(ds, id= c("pointyear", "PointId", "year"))

ds2 = subset(ds, subset = year == max(levels(year)))
ds1 = subset(ds, subset = year == min(levels(year)))

dsyear = merge(ds1, ds2, by = c("PointId", "variable"))
dsyear$change = dsyear$value.y - dsyear$value.x

dsmean = aggregate(dsyear, by = list(dsyear$variable), FUN = "mean", na.rm = TRUE)
dsmean = subset(dsmean, select = c(Group.1, value.y, change))
colnames(dsmean) = c("variable", "covermean", "changemean")
dsse = aggregate(dsyear, by = list(dsyear$variable), FUN = "se")
dsse = subset(dsse, select = c(Group.1, value.y, change))
colnames(dsse) = c("variable", "coverse", "changese")

all_ds = merge(dsmean, dsse, by = "variable")



# dstypes = melt(ds, by = "year")
# dstypes = subset(dstypes, select = c("PointId", "year", "variable", "value"))
# dsyear = aggregate(dstypes, by = list(dstypes$year, dstypes$variable), FUN = "mean")
# dsyear = subset(dsyear, select = c(Group.1, Group.2, value))
# colnames(dsyear) = c("year", "variable", "value")
# 
# dsyearse = aggregate(dstypes, by = list(dstypes$year, dstypes$variable), FUN = "se")
# dsyearse = subset(dsyearse, select = c(Group.1, Group.2, value))
# colnames(dsyearse) = c("year", "variable", "se")
# 
# # ds2 = subset(dsyear, subset = year == max(levels(year)))
# # ds1 = subset(dsyear, subset = year == min(levels(year)))
# # ds2se = subset(dsyearse, subset = year == max(levels(year)))
# # ds1se = subset(dsyearse, subset = year == min(levels(year)))
# 
# dsyear2 = merge(ds2, ds1, by = "variable")
# dsyear2$change = dsyear2$value.x - dsyear2$value.y
# 



```


Here is a summary of species richness, litter, thatch, bare ground, tree cover, and shrub cover. Tree cover and shrub cover come from the releve here.

```{r echo = FALSE, message = FALSE, warning = FALSE}

cp = ggplot(all_ds, aes(x = variable, y = covermean)) + geom_col() + theme_bw() + geom_errorbar(ymin = all_ds$covermean - all_ds$coverse, ymax = all_ds$covermean + all_ds$coverse, width = 0.5) + ylim((min(all_ds$covermean) - max(all_ds$coverse)), (max(all_ds$covermean) + max(all_ds$coverse)))
cp



```




```{r echo = FALSE, message = FALSE, warning = FALSE}

cp2 = ggplot(all_ds, aes(x = variable, y = changemean)) + geom_col() + theme_bw() + geom_errorbar(ymin = all_ds$changemean - all_ds$changese, ymax = all_ds$changemean + all_ds$changese, width = 0.5) + ylim((min(all_ds$changemean) - max(all_ds$changese)), (max(all_ds$changemean) + max(all_ds$changese)))
cp2



```












